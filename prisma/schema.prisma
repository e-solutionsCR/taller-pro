generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Client {
  id        Int      @id @default(autoincrement())
  cedula    String   @unique
  nombre    String
  email     String?
  telefono  String?
  direccion String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  tickets   Ticket[]
}

model Ticket {
  id              Int      @id @default(autoincrement())
  codigo          String   @unique
  descripcion     String
  tipoDispositivo String
  marcaModelo     String?
  numeroSerie     String?
  password        String?
  diagnostico     String?
  costo           Decimal?
  status          String   @default("RECIBIDO")
  clientId        Int
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  client          Client   @relation(fields: [clientId], references: [id])

  @@index([clientId], map: "Ticket_clientId_fkey")
}

model TipoDispositivo {
  id        Int      @id @default(autoincrement())
  nombre    String   @unique
  precioRevision Decimal @default(0)
  precioReparacionMinima Decimal @default(0)
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Marca {
  id        Int      @id @default(autoincrement())
  nombre    String   @unique
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id        Int      @id @default(autoincrement())
  nombre    String
  email     String   @unique
  password  String
  rol       String   @default("USER")
  activo    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  passwordResetTokens PasswordResetToken[]
}

model EmailConfig {
  id           Int      @id @default(autoincrement())
  smtpHost     String
  smtpPort     Int
  smtpUser     String
  smtpPassword String   // Encrypted
  fromEmail    String
  fromName     String
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model PasswordResetToken {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  userId    Int
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}
